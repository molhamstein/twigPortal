<div  class="items page-layout carded fullwidth" layout="row">

    <!-- TOP BACKGROUND -->
    <div class="top-bg md-accent-bg"></div>
    <!-- / TOP BACKGROUND -->

    <!-- CENTER -->
    <div st-pipe="vm.callServer" st-table="displayed" class="center" layout="column" flex>
        <!-- CONTENT HEADER -->
        <div  class="header" layout="row" layout-align="space-between center">
            <div class="white-fg" layout="column" layout-align="start start">
                <div class="h1" layout="row" layout-align="start center">
                    <md-icon>title</md-icon>
                    <span translate="TWIGS.ITEMS">Items</span>
                </div>
                <div class="order-count secondary-text">
                    <span translate="TWIGS.ALL_ITEMS">Total Items: </span>
                    <span>{{total_pages}}</span>
                </div>
            </div>

            <div class="search" layout="row" layout-align="start center" flex>
                <md-input-container flex>
                    <md-icon class="white-text icon search-icon">search</md-icon>
                    <label>{{'USERS.SEARCH'| translate}}</label>
                    <input ng-model="searchKeyword" flex>
                </md-input-container>             

            </div>
            <div>
                <!--                <md-button class="md-raised md-background" id="delete-item-button"
                                           ng-click="vm.deleteSelectedItems($event)"
                                           aria-label="add item"vtranslate-attr-aria-label="TWIGS.DELETE_ITEM">
                                    {{"TWIGS.DELETE_ITEM"| translate}}
                                </md-button>-->

                <md-button class="md-raised md-background n" id="add-item-button"                      
                           ui-sref="app.twigs.add-twig"
                           aria-label="add item" translate translate-attr-aria-label="TWIGS.ADD_ITEM">
                    {{"TWIGS.ADD_ITEM"| translate}}
                </md-button>
                <md-button class="md-raised md-background md-icon-button" 
                           ng-click="vm.businessesFilter()"
                           aria-label="BUSINESSES" translate translate-attr-aria-label="TWIGS.BUSINESSES">
                    <md-icon>filter_list</md-icon>
                    <!--{{"TWIGS.BUSINESSES"| translate}}-->
                </md-button>

                <md-button ng-show='vm.filterApplied' class="md-raised md-background md-icon-button" 
                           ng-click="vm.removeFilter()"
                           aria-label="BUSINESSES" translate translate-attr-aria-label="TWIGS.BUSINESSES">
                    <md-icon>close</md-icon>                                       
                </md-button>
            </div>
        </div>
        <!-- / CONTENT HEADER -->

        <!-- CONTENT CARD -->
        <md-content class="content-card" layout="column" flex>
            <md-sidenav class="md-sidenav-right md-whiteframe-4dp" md-component-id="right">
                <md-button ng-click="vm.closeBusinessesFilter()" class="md-icon-button">
                    <md-icon class=' md-primary'>close</md-icon>
                </md-button>
                <!--                <md-toolbar class="md-theme-light" layout='row' layout='space-between center'>
                                    <h1 class="md-toolbar-tools"> {{"TWIGS.BUSINESSES"| translate}}</h1>
                                    <span flex></span>
                                    <md-button ng-click="vm.closeBusinessesFilter()" class="md-icon-button">
                                        <md-icon class=' md-primary'>close</md-icon>
                                    </md-button>
                                </md-toolbar>-->
                <md-content  layout-padding>
                    <!--<form flex>-->
                    <md-list>
                        <md-list-item class="md-2-line">  
                            <md-icon>business</md-icon> 
                            <md-autocomplete                  flex  
                                                              md-require-match                                                             
                                                              md-delay="2000"
                                                              md-no-cache="false"
                                                              md-selected-item="selectedBusiness"
                                                              md-search-text="searchBusiness"
                                                              md-selected-item-change="selectedBusinessChange(i)"
                                                              md-items="i in onChangeBusiness(searchBusiness)"
                                                              md-item-text="i.name"
                                                              md-min-length="0"
                                                              md-floating-label="{{'TWIGS.SEARCH_BUSINESS'| translate}}">                                
                                <md-item-template>                                    
                                    <span md-highlight-text="searchBusiness" md-highlight-flags="^i">{{i.name}}</span>
                                </md-item-template>
                                <md-not-found>
                                    No Businesses matching {{searchBusiness}} were found.
                                    <!--<a ng-click="newState(searchText)">Create a new one!</a>-->
                                </md-not-found>
                            </md-autocomplete>                                                                                                  
                        </md-list-item>    
                        <md-list-item class="md-2-line">  
                            <md-icon>location_on</md-icon> 
                            <md-autocomplete                  flex  
                                                              md-require-match                                                             
                                                              md-delay="2000"
                                                              md-no-cache="false"
                                                              md-selected-item="selectedLocation"
                                                              md-search-text="searchLocation"
                                                              md-selected-item-change="selectedLocationChange(i)"
                                                              md-items="i in onChangeLocation(searchLocation)"
                                                              md-item-text="i.name"
                                                              md-min-length="0"
                                                              md-floating-label="{{'TWIGS.SEARCH_LOCATION'| translate}}">                                
                                <md-item-template>                                    
                                    <span md-highlight-text="searchLocation" md-highlight-flags="^i">{{i.name}}</span>
                                </md-item-template>
                                <md-not-found>
                                    No Locations matching {{searchLocation}} were found.
                                    <!--<a ng-click="newState(searchText)">Create a new one!</a>-->
                                </md-not-found>
                            </md-autocomplete>                                                                                                  
                        </md-list-item>    

                    </md-list>
                    <!--                    <md-input-container flex>
                                            <md-icon>search</md-icon>
                                            <label>{{'TWIGS.SEARCH_BUSINESS'| translate}}</label>
                                            <input type="text"  ng-model="business_name" md-autofocus>
                                        </md-input-container>
                                        <md-input-container flex>
                                            <md-icon>search</md-icon>
                                            <label>{{'TWIGS.SEARCH_LOCATION'| translate}}</label>
                                            <input type="text"  ng-model="location_name">
                                        </md-input-container>-->
                    <!--                        <md-autocomplete                                                       
                                                md-selected-item="selectedBusiness"
                                                md-search-text-change="searchBusinessChange(searchBusiness)"
                                                md-search-text="searchBusiness"
                                                md-selected-item-change="selectedBusinessChange(bus)"
                                                md-items="bus in querySearch(searchBusiness)"
                                                md-item-text="bus.name"
                                                md-min-length="0"
                                                md-require-match
                                                md-floating-label="{{'TWIGS.SEARCH_BUSINESS'| translate}}">
                                                <md-item-template>
                                                    <span md-highlight-text="searchBusiness" md-highlight-flags="^i">{{bus.name}}</span>
                                                </md-item-template>
                                                <md-not-found>
                                                    No states matching "{{searchBusiness}}" were found.                               
                                                </md-not-found>
                                            </md-autocomplete>-->
                    <!--</form>-->    
                    <!--                    <div ng-show='isSideNavLoading'>
                                            <md-progress-linear md-mode="indeterminate"></md-progress-linear>
                                        </div>
                                        <md-list class="md-dense" flex>
                                            <md-subheader class="md-no-sticky">3 line item (dense)</md-subheader>
                                            <md-list-item class="md-3-line" ng-repeat="business in vm.businessesList| filter:business_name"
                                                          ng-click='vm.getData(business.id)'>
                                                <img ng-src="{{business.logo}}" class="md-avatar" alt="{{business.name}}" />
                                                <div class="md-list-item-text" layout="column">
                                                    <h3>{{ business.name}}</h3>
                                                                                    <h4>{{ item.what}}</h4>
                                                                                    <p>{{ item.notes}}</p>
                                                </div>
                                            </md-list-item>
                                            <md-divider ></md-divider>
                                        </md-list>-->
                </md-content>

            </md-sidenav>
            <!-- CONTENT -->
            <div class="content fullpage-datatable" layout="column" flex>

                <table  class="dataTable row-border hover table table-striped">
                    <thead>
                        <tr>             
                            <th  st-sort="id">  ID   </th>
                            <th  >Media    </th>                                                           
                            <th st-sort="price">Price</th> 
                            <th>Average Rating</th> 
                            <th st-sort="user">User</th>
                            <th st-sort="category.name"> Category  </th>                                                              
                            <th st-sort="location.name">Location  </th>    
                            <th st-sort="business.name">Business  </th>    
                            <th st-sort="products">Products</th>
                            <th st-sort="tags">Tags</th>
                            <th st-sort="is_exceptional">Is Exceptional</th>
                            <th st-sort="description">Description</th>
                            <th></th>
                        </tr>                            
                    </thead>
                    <tbody ng-show="!vm.isLoading">
                        <tr ng-repeat="item in  displayed| filter: searchKeyword" ng-click="vm.itemDetails(item.id)">                           
                            <td>{{item.id}}</td>
                            <td><img class="item-image" ng-src="{{item.media}}"></td>   
                            <td>{{item.price}}</td>                           
                            <td>
                                <div ng-if="item.average < 3" class="quantity-indicator md-red-500-bg"></div>
                                <div ng-if="item.average === 3" class="quantity-indicator md-amber-500-bg"></div>
                                <div ng-if="item.average > 3" class="quantity-indicator md-green-600-bg"></div>
                                <div>{{item.average}}</div>
                            <td>{{item.user.name}}</td>
                            <!--                            <td>{{item.service}}</td>
                                                        <td>{{item.reasonable_price}}</td>-->                           
                            <td>{{item.category.name}}</td>
                            <td>{{item.location.name}}</td>  
                            <td>{{item.business.name}}</td>
                            <td > {{item.products[0].name}}
                                <!--<span ng-repeat="p in item.products">{{p.name}}<span ng-hide="$last">,</span></span>   -->
                            </td>   
                            <td>
                                <span ng-repeat="tag in item.tags track by $index">{{tag.name}}
                                    <span ng-hide="$last">,&nbsp;</span>                                   
                                    <!--<br ng-if="$index !==0 && $index%4 === 0">-->
                                </span>                       
                            </td>
                            <td>
                                <span ng-if="item.is_exceptional === 1"><i style="padding: 0 10px" class="icon-checkbox-marked-circle green-500-fg"></i></span>
                                <span ng-if="item.is_exceptional === 0"><i style="padding: 0 10px" class="icon-cancel red-500-fg"></i></span>
                            </td>
                            <td>{{item.description}}</td>   
                            <td>          
                    <md-menu>
                        <md-button class="md-icon-button" aria-label="More" translate
                                   translate-attr-aria-label="TWIGS.MORE"  ng-click="$mdOpenMenu($event)">
                            <md-icon>more_vert</md-icon>
                        </md-button>
                        <md-menu-content width="3">
                            <md-menu-item>                                
                                <md-button 
                                    ng-click="vm.editItem(item)" 
                                    aria-label="TWIGS details"
                                    translate translate-attr-aria-label="TWIGS.PROFILE">  
                                    Edit Twig
                                </md-button>
                            </md-menu-item>    
                            <md-menu-item>
                                <md-button ng-click="deleteItemConfirm(item, ev)"
                                           translate="TWIGS.DELETE_ITEM">
                                    Delete item
                                </md-button>
                            </md-menu-item> 

                        </md-menu-content>
                    </md-menu>
                    </td>
                    </tr>
                    </tbody>
                    <tbody ng-show="vm.isLoading">
                        <tr>
                            <td colspan="12" class="text-center">Loading ... </td>
                        </tr>
                    </tbody>                   
                    <tfoot >
                        <tr >
                            <td st-pagination=""  st-items-by-page="itemsByPage" st-displayed-pages="20" colspan="11"> </td>
                        </tr>
                    </tfoot>

                </table>

            </div>
            <!-- / CONTENT -->

        </md-content>        
    </div>
    <!-- / CENTER -->

</div>



